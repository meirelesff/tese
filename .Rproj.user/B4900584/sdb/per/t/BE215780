{
    "collab_server" : "",
    "contents" : "#' BW plot\n#'\n#' Funcao para plotar sensibilidade do estimador RD\n#'\n#' @param x scores;\n#' @param y Var dependente;\n#' @param c Cutpoint;\n#' @param p Polinomio (default 1);\n#' @param h_bw Vetor com os valores inicial, final e intervalos do BW;\n#' @param cluster Cluster robust SE;\n#' @param level CI;\n#'\n#' @import ggplot2\n#' @import rdrobust\n#' @importFrom stats quantile\n#'\n#' @export\n#'\n#' @return A ggplot object;\n\nplot_bw <- function(y, x, c = 0, p = 1, h_bw = NULL, cluster = NULL, level = 95){\n  \n  # Input tests\n  if(is.null(h_bw)){\n    qnts <- as.numeric(quantile(abs(x), probs = seq(0, 1, by = 0.1), na.rm = T))\n    h_bw <- c(qnts[2], qnts[8], 50)\n    h <- seq(qnts[2], qnts[8], length.out = 50)\n  }\n  else {\n    \n    h <- seq(h_bw[1], h_bw[2], by = h_bw[3])\n  }\n  # Calculate the estimates\n  coef <- ci_up <- ci_low <- numeric(length(h))\n  for (i in 1:length(h)){\n    reg <- rdrobust::rdrobust(x = x, y = y, c = c, p = p, h = h[i], level = level, cluster = cluster)\n    coef[i] <- reg$coef[1]\n    ci_up[i] <- reg$ci[3]\n    ci_low[i] <- reg$ci[6]\n  }\n  \n  # Plots\n  out <- data.frame(coef = coef, ci_up = ci_up, ci_low = ci_low, h = h)\n  \n  ggplot2::ggplot(out, ggplot2::aes(x = h, y = coef)) + ggplot2::geom_line(size = 0.82) +\n    ggplot2::geom_ribbon(ggplot2::aes(ymin = ci_up, ymax = ci_low), alpha = 0.2) +\n    ggplot2::scale_y_continuous(expand = c(0, 0)) +\n    ggplot2::scale_x_continuous(expand = c(0, 0)) +\n    ggplot2::geom_hline(yintercept = c, linetype = \"dashed\", size = 0.3)\n}\n",
    "created" : 1502646905052.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "582782684",
    "id" : "BE215780",
    "lastKnownWriteTime" : 1522434085,
    "last_content_update" : 1522434085,
    "path" : "~/GitHub/tese/R/plot_bw.R",
    "project_path" : "R/plot_bw.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}